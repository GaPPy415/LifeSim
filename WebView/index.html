<!DOCTYPE html>
<html>
<head>
  <title>Life Viewer</title>
</head>
<body>
  <canvas id="view" width="1000" height="1000" style="border:1px solid"></canvas>
  <script>
    const socket = new WebSocket("ws://localhost:5000/ws");
    const canvas = document.getElementById("view");
    const ctx = canvas.getContext("2d");

    const entities = {};
    const lerpDuration = 100;

    const lerp = (a, b, t) => a + (b - a) * t;

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      const now = performance.now();

      for (const id in data) {
        const curr = data[id];
        if (!entities[id]) {
          entities[id] = {
            prev: curr,
            curr,
            lastUpdate: now
          };
        } else {
          entities[id].prev = entities[id].curr;
          entities[id].curr = curr;
          entities[id].lastUpdate = now;
        }
      }
    };

    const render = () => {
      const now = performance.now();
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (const id in entities) {
        const { prev, curr, lastUpdate } = entities[id];
        const t = Math.min((now - lastUpdate) / lerpDuration, 1);
        const x = lerp(prev.X, curr.X, t) * 1;
        const y = lerp(prev.Y, curr.Y, t) * 1;
        const color = curr.Color;

        ctx.beginPath();
        ctx.arc(x, y, 5, 0, Math.PI * 2);
        ctx.fillStyle = color;
        ctx.fill();
      }

      requestAnimationFrame(render);
    }

    requestAnimationFrame(render);
  </script>
</body>
</html>
